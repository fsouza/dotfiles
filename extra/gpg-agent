[ -f ~/.gpg-agent-info ] && source ~/.gpg-agent-info

if [ -S "${GPG_AGENT_INFO%%:*}" ]; then
	export GPG_AGENT_INFO SSH_AUTH_SOCK SSH_AGENT_PID
else
	rm -f ~/.gpg-agent.log
	if [ "$(uname -s)" = "Darwin" ]; then
		pinentry=$(which pinentry-mac)
	else
		pinentry=$(which pinentry)
	fi
	eval $(gpg-agent --daemon --disable-scdaemon --log-file ~/.gpg-agent.log --pinentry-program ${pinentry} --write-env-file ~/.gpg-agent-info)
fi
