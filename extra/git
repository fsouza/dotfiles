function _git_enable_difftastic {
	local configs=(
		diff.tool difftastic
		difftool.prompt false
		'difftool.difftastic.cmd' 'difft --background=light "${LOCAL}" "${REMOTE}"'
		pager.difftool true
	)
	local config_idx=${GIT_CONFIG_COUNT:-0}

	for ((i = 1; i < ${#configs}; i += 2)); do
		export \
			GIT_CONFIG_KEY_${config_idx}=${configs[$i]} \
			GIT_CONFIG_VALUE_${config_idx}=${configs[$((i + 1))]}
		config_idx=$((config_idx + 1))
	done

	export GIT_CONFIG_COUNT=${config_idx}
}

if [[ -v HOMEBREW_PREFIX ]]; then
	export PERLLIB=${HOMEBREW_PREFIX}/opt/git/share/perl5:${PERLLIB+:$PERLLIB}
fi

if command -v difft &>/dev/null; then
	_git_enable_difftastic
fi
