#!/bin/bash -e

# This script setups this repository, intializing the submodules, setting up
# symlinks and copying any required files.

os=$(uname -s)
basedir=$(cd $(dirname $0)/..; pwd -P)

pushd $basedir
git submodule update --init --recursive
popd

files=".bash_profile .clang-format .gitconfig .gitignore_global .hgignore_global .hgrc .editorconfig .utoprc .alacritty.yml"
for file in $files; do
	ln -sf ${basedir}/${file} ~/${file}
done
ln -sf ${basedir}/.bash_profile ~/.bashrc

mkdir -p $HOME/.config
ln -sf ${basedir}/pycodestyle $HOME/.config/pycodestyle

mkdir -p ~/.gnupg
chmod 700 ~/.gnupg
ln -sf ${basedir}/gpg.conf ~/.gnupg/gpg.conf

if [ -f $basedir/bin/${os}-setup ]; then
	$basedir/bin/${os}-setup
fi

if [ -n "$NVM_DIR" ]; then
	mkdir -p $NVM_DIR
	curl -s https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
fi
