#!/bin/zsh -e

# This script setups this repository, intializing the submodules, setting up
# symlinks and copying any required files.

os=$(uname -s)
basedir=$(
	cd $(dirname $0)/..
	pwd -P
)

pushd $basedir
git submodule update --init --recursive
popd

files=(.zshrc .clang-format .editorconfig .utoprc)
for file in $files; do
	ln -sf ${basedir}/${file} ~/${file}
done

mkdir -p ${HOME}/.config
xdg_files=(tmux.conf tmux.${os}.conf alacritty.yml rgrc)
for file in $xdg_files; do
	ln -sf ${basedir}/${file} ${HOME}/.config/${file}
done

mkdir -p ${HOME}/.config/git
ln -sf ${basedir}/gitconfig ${HOME}/.config/git/config
ln -sf ${basedir}/gitignore_global ${HOME}/.config/git/gitignore

mkdir -p ${HOME}/.config/fd
ln -sf ${basedir}/fdignore ${HOME}/.config/fd/ignore

mkdir -p ~/.gnupg
chmod 700 ~/.gnupg
ln -sf ${basedir}/gpg.conf ~/.gnupg/gpg.conf

if [ -f $basedir/bin/${os}-setup ] && [[ $1 != "--skip-os" ]]; then
	$basedir/bin/${os}-setup
fi
