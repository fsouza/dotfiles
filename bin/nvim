#!/usr/bin/env zsh

set -euo PIPEFAIL

THIS_SCRIPT=$(realpath "$0")

function find_nvim {
	while read p; do
		if [[ $p != "${THIS_SCRIPT}" ]]; then
			echo $p
			return 0
		fi
	done <<<$(which -a nvim)
}

executable=$(find_nvim)
if ! [ -x ${executable} ]; then
	echo >&2 neovim is not installed
	exit 2
fi

dotfiles=$(\builtin cd "$(dirname "${0}")/.." && pwd -P)

if [[ ${OSTYPE} == darwin* ]]; then
	profile="${dotfiles}/neovim.sb"
	exec sandbox-exec -f "${profile}" "${executable}" "$@"
else
	exec unshare --map-root-user --net "${executable}" "$@"
fi
