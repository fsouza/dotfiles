#!/bin/csh -e

unsetenv CFLAGS
set hg=$VIRTUALENVS/go/bin/hg
pushd $GOROOT/src
set old=`$hg tip --template "{node}"`
$hg sync
set new=`$hg tip --template "{node}"`
if($new != $old || "$1" == "-f") then
	./make.bash
	go get -u golang.org/x/tools/cmd/vet
	go get -u golang.org/x/tools/cmd/cover
	go get -u golang.org/x/tools/cmd/godoc
	go get -u golang.org/x/tools/cmd/oracle
	go get -u golang.org/x/tools/cmd/goimports
	go get -u code.google.com/p/go.talks/present
	go get -u code.google.com/p/go.codereview/cmd/hgapplydiff
	rm -rf `go env GOROOT`/pkg/*_race
	go install -race std
endif
popd
