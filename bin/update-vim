#!/bin/csh -e

pushd ${HOME}/opt/src/vim
set old=`hg tip --template "{node}"`
hg pull -u
set new=`hg tip --template "{node}"`
if($new != $old || "$1" == "-f") then
	patch -p1 < $HOME/Projects/dotfiles/patches/vim_sigaltstack.diff
	./configure --prefix=${HOME}/opt --enable-gui=no --without-x --enable-multibyte --with-tlib=ncurses --enable-cscope --with-features=huge --enable-pythoninterp --enable-rubyinterp
	make -j4
	hg revert --all
	sudo make -j4 install prefix=${HOME}/opt
endif
popd
